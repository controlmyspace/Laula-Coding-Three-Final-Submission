<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almaty Smog Clock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #fff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            display: flex;
            gap: 80px;
            align-items: center;
            justify-content: center;
        }

        /* the analog clock */
        .clock-container {
            position: relative;
        }

        .clock {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: white;
            position: relative;
            border: 3px solid #000;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }

        .clock-center {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #000;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .hour-hand {
            position: absolute;
            width: 6px;
            height: 80px;
            background: #000;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%);
            border-radius: 3px 3px 0 0;
            cursor: grab;
            z-index: 3;
        }

        .hour-hand:active {
            cursor: grabbing;
        }

        .minute-hand {
            position: absolute;
            width: 4px;
            height: 110px;
            background: #000;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%);
            border-radius: 2px 2px 0 0;
            cursor: grab;
            z-index: 2;
        }

        .minute-hand:active {
            cursor: grabbing;
        }



        .hour-number {
            position: absolute;
            font-size: 14px;
            font-weight: bold;
            color: #000;
            transform: translate(-50%, -50%);
        }

        /* the almaty mountains photo with a smog overlay on top */
        .image-container {
            position: relative;
            width: 500px;
            height: 375px;
            overflow: hidden;
            border-radius: 8px;
        }

        .mountain-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .smog-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, 
                rgba(200, 200, 200, 0.9) 0%, 
                rgba(220, 220, 220, 0.7) 40%, 
                rgba(240, 240, 240, 0.4) 70%, 
                rgba(255, 255, 255, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            backdrop-filter: blur(0px);
        }

        .time-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 100;
        }

        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: rgba(0, 0, 0, 0.7);
            font-size: 14px;
            max-width: 300px;
            line-height: 1.6;
        }

        .info-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: rgba(0, 0, 0, 0.9);
        }
    </style>
</head>
<body>
    <div class="info">
        <div class="info-title">Almaty Smog Clock</div>
        Drag the clock hands to see how air pollution changes throughout the day.
        <br><br>
        Peak traffic hours: 7-9am, 2-4pm, 5-8pm
    </div>

    <div class="container">
        <div class="clock-container">
            <div class="clock" id="clock">
                <!-- Hour markers will be generated by JS -->
                <div class="minute-hand" id="minuteHand"></div>
                <div class="hour-hand" id="hourHand"></div>
                <div class="clock-center"></div>
            </div>
        </div>

        <div class="image-container">
            <img src="almaty_mountains.jpeg" alt="Almaty Mountains" class="mountain-image">
            <div class="smog-overlay" id="smogOverlay"></div>
            <div class="time-display" id="timeDisplay">00:00</div>
        </div>
    </div>

    <script>
        // grab all the page elements
        const hourHand = document.getElementById('hourHand');
        const minuteHand = document.getElementById('minuteHand');
        const smogOverlay = document.getElementById('smogOverlay');
        const timeDisplay = document.getElementById('timeDisplay');
        const clock = document.getElementById('clock');

        // set initial time to right now
        let currentHour = new Date().getHours();
        let currentMinute = new Date().getMinutes();
        let isDragging = false;
        let dragTarget = null;

        // rush hour times in almaty when traffic (and smog) is worst
        const peakHours = [7, 8, 9, 14, 15, 16, 17, 18, 19, 20];

        // create the clock face with 24 hour numbers around the edge
        function createClockFace() {
            for (let i = 0; i <= 23; i++) {
                // make a div for each hour number
                const number = document.createElement('div');
                number.className = 'hour-number';
                // some trig to position the numbers in a circle
                const angle = (i * 15 - 90) * Math.PI / 180;
                const radius = 120;
                const x = 150 + radius * Math.cos(angle);
                const y = 150 + radius * Math.sin(angle);
                number.style.left = x + 'px';
                number.style.top = y + 'px';
                number.textContent = i;
                
                clock.appendChild(number);
            }
        }

        // calculate how thick the smog should be based on the time
        function calculateSmogOpacity(hour, minute) {
            const totalMinutes = hour * 60 + minute;
            
            // define the rush hour periods when smog accumulates
            const peakPeriods = [
                { start: 7 * 60, end: 10 * 60 },    // morning commute + hour after
                { start: 14 * 60, end: 17 * 60 },   // afternoon
                { start: 17 * 60, end: 21 * 60 }    // evening commute + hour after
            ];

            let maxOpacity = 0;

            // see if we're currently in a peak period
            peakPeriods.forEach(period => {
                if (totalMinutes >= period.start && totalMinutes <= period.end) {
                    const periodDuration = period.end - period.start;
                    const elapsed = totalMinutes - period.start;
                    // smog gradually builds up over the rush hour
                    const opacity = Math.min((elapsed / periodDuration) * 0.85, 0.85);
                    maxOpacity = Math.max(maxOpacity, opacity);
                }
            });

            // nighttime is clearer (less traffic)
            if (hour >= 22 || hour < 6) {
                maxOpacity = Math.max(maxOpacity, 0.1);
            } else if (maxOpacity === 0) {
                // normal daytime still has some baseline pollution
                maxOpacity = 0.3;
            }

            // add blur effect - more smog = more blur
            const blurAmount = maxOpacity * 8;
            smogOverlay.style.backdropFilter = `blur(${blurAmount}px)`;

            return maxOpacity;
        }

        // update everything when time changes
        function updateClock() {
            // work out the rotation angles (24hr clock so divide by 24, not 12)
            const hourAngle = (currentHour * 15) + (currentMinute / 60) * 15;
            const minuteAngle = currentMinute * 6;

            // spin the clock hands
            hourHand.style.transform = `translateX(-50%) rotate(${hourAngle}deg)`;
            minuteHand.style.transform = `translateX(-50%) rotate(${minuteAngle}deg)`;

            // adjust the smog overlay
            const smogOpacity = calculateSmogOpacity(currentHour, currentMinute);
            smogOverlay.style.opacity = smogOpacity;

            // update the time display text
            const displayHour = currentHour.toString().padStart(2, '0');
            const displayMinute = currentMinute.toString().padStart(2, '0');
            timeDisplay.textContent = `${displayHour}:${displayMinute}`;
        }

        // drag handlers - these let you drag the clock hands around
        function startDrag(e, target) {
            isDragging = true;
            dragTarget = target;
            e.preventDefault();
        }

        // update time while you're dragging
        function drag(e) {
            if (!isDragging) return;

            // figure out where the center of the clock is
            const rect = clock.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            // get mouse position (works for touch too)
            const mouseX = e.clientX || e.touches[0].clientX;
            const mouseY = e.clientY || e.touches[0].clientY;

            // calculate the angle from clock center to mouse
            let angle = Math.atan2(mouseY - centerY, mouseX - centerX);
            angle = angle * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            // set time based on which hand is being dragged
            if (dragTarget === hourHand) {
                // round to nearest hour (24hr clock so divide by 15, not 30)
                currentHour = Math.round(angle / 15) % 24;
            } else if (dragTarget === minuteHand) {
                currentMinute = Math.round(angle / 6) % 60;
            }

            updateClock();
        }

        // stop dragging when mouse is released
        function stopDrag() {
            isDragging = false;
            dragTarget = null;
        }

        // wire up all the drag event listeners
        // mouse events
        hourHand.addEventListener('mousedown', (e) => startDrag(e, hourHand));
        minuteHand.addEventListener('mousedown', (e) => startDrag(e, minuteHand));
        
        // touch events for mobile
        hourHand.addEventListener('touchstart', (e) => startDrag(e, hourHand));
        minuteHand.addEventListener('touchstart', (e) => startDrag(e, minuteHand));

        // listen for dragging on the whole document
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);

        // automatically update the clock every second (if not dragging)
        setInterval(() => {
            if (!isDragging) {
                const now = new Date();
                currentHour = now.getHours();
                currentMinute = now.getMinutes();
                updateClock();
            }
        }, 1000);

        // initialize everything
        createClockFace();
        updateClock();
    </script>
</body>
</html>